<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantile Estimation Procedures • ldc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quantile Estimation Procedures">
<meta property="og:description" content="ldc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ldc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction to ldc</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Quantile Estimation Procedures</a>
    </li>
    <li>
      <a href="../articles/units.html">Why Units</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/TxWRI/ldc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="exceedance_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quantile Estimation Procedures</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TxWRI/ldc/blob/gh-pages/vignettes/articles/exceedance.Rmd" class="external-link"><code>vignettes/articles/exceedance.Rmd</code></a></small>
      <div class="hidden name"><code>exceedance.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TxWRI/ldc" class="external-link">ldc</a></span><span class="op">)</span></code></pre></div>
<p><span class="citation">Vogel and Fennessey (1994)</span> describes the flow duration curve (FDC), from which the load duration curve (LDC) is calculated, as the complement of the cumulative distribution function of daily streamflow. For each value of discharge, the corresponding exceedance probability <span class="math inline">\(p\)</span> is calculated as 1 minus the empirical cumulative distribution function. <span class="math inline">\(p\)</span> is calculated for each observation <span class="math inline">\(Q_i\)</span> where <span class="math inline">\(i = 1, 2, ... n\)</span>:</p>
<p><span class="math display">\[
p = 1 - P \{Q_i\le q_0\} \\
\]</span></p>
<p>The quantile <span class="math inline">\(Q_p\)</span> is the empirical quantile function.</p>
<p>The default method for estimating <span class="math inline">\(p\)</span> is the Weibull plotting position (<code>estimator = 6</code>). The Weibull plotting position provides a unbiased estimates of <span class="math inline">\(p_i\)</span> regardless of the underlying streamflow distribution <span class="citation">(Vogel and Fennessey 1994)</span>. The Weibull plotting position is calculated <span class="math inline">\(p\)</span> where <span class="math inline">\(q_i\)</span>, <span class="math inline">\(i = 1, 2, ... n\)</span>, is the <span class="math inline">\(i\)</span>th sorted streamflow value:</p>
<p><span class="math display">\[
p = P(Q &gt; q_i) =  \frac{i}{n+1}
\]</span></p>
<p>This is equivalent to <span class="math inline">\(Q_{p,1}\)</span> described in <span class="citation">Vogel and Fennessey (1994)</span> and is the default method used in <code><a href="../reference/calc_ldc.html">calc_ldc()</a></code> and <code><a href="../reference/calc_annual_ldc.html">calc_annual_ldc()</a></code>.</p>
<div class="section level2">
<h2 id="alternative-quantile-estimators">Alternative Quantile Estimators<a class="anchor" aria-label="anchor" href="#alternative-quantile-estimators"></a>
</h2>
<p>The Harrell-Davis distribution-free quantile estimator (<code>estimator = "hd"</code>) is described by <span class="citation">Harrell and Davis (1982)</span>, which is equivalent to <span class="math inline">\(Q_{p,3}\)</span> described in <span class="citation">Vogel and Fennessey (1994)</span>. The math is not included here, but can be found in both <span class="citation">Vogel and Fennessey (1994)</span> and <span class="citation">Harrell and Davis (1982)</span>. <span class="citation">Vogel and Fennessey (1994)</span> note this estimator provides smoother estimates of quantiles than <span class="math inline">\(Q_{p,1}\)</span> for small samples. This is particularly advantageous in calculating annualized flow duration curves and only included for the <code><a href="../reference/calc_annual_ldc.html">calc_annual_ldc()</a></code> function. The <code><a href="../reference/calc_annual_ldc.html">calc_annual_ldc()</a></code> function returns the quantiles only at measured streamflow values, so estimation of quantiles is not needed they are returned directly by the plotting position methods (estimator = 5:9).</p>
<p>Exceedance probabilities can also be calculated using the continuous sample quantiles types 5 through 9 documented in <code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile()</a></code>. Type 6 is the default and described above. Type 5 is described in <span class="citation">Hanzen (1914)</span>:</p>
<p><span class="math display">\[
p = P(Q &gt; q_i) =  \frac{i - 0.5}{n}
\]</span></p>
<p>The figure below shows the annual FDC resulting from each of the estimator methods:</p>
<pre><code><span class="co">#&gt; udunits database from /usr/share/xml/udunits/udunits2.xml</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="co">#&gt; Warning: Transformation introduced infinite values in continuous x-axis</span>

<span class="co">#&gt; Warning: Transformation introduced infinite values in continuous x-axis</span></code></pre>
<p><img src="exceedance_files/figure-html/annualldcs-1.png" width="700"></p>
<p>The x-axis is log transformed to highlight differences in the highest flow regimes. Methods 5 through 9 have minor differences in shape, although estimates are very close. The Harrell-Davis method results in a notably smoother estimated median and confidence interval.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-hanzen_storage_1914">
<p>Hanzen, Allen. 1914. “Storage to Be Provided in Impounding Municipal Water Supply.” <em>Transactions of the American Society of Civil Engineers</em> 77 (1). <a href="https://doi.org/10.1061/taceat.0002563" class="external-link">https://doi.org/10.1061/taceat.0002563</a>.</p>
</div>
<div id="ref-harrell_new_1982">
<p>Harrell, Frank E, and C E Davis. 1982. “A New Distribution-Free Quantile Estimator.” <em>Biometrika</em> 69 (3).</p>
</div>
<div id="ref-vogel_flowduration_1994">
<p>Vogel, Richard M., and Neil M. Fennessey. 1994. “Flow‐Duration Curves. I: New Interpretation and Confidence Intervals.” <em>Journal of Water Resources Planning and Management</em> 120 (4): 485–504. <a href="https://doi.org/10.1061/(ASCE)0733-9496(1994)120:4(485)" class="external-link">https://doi.org/10.1061/(ASCE)0733-9496(1994)120:4(485)</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Schramm.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
