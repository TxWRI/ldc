<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate annualized load duration curve — calc_annual_ldc • ldc</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate annualized load duration curve — calc_annual_ldc"><meta property="og:description" content="Calculates the median annual ldc with confidence intervals."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ldc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Introduction.html">Introduction to ldc</a>
    </li>
    <li>
      <a href="../articles/exceedance.html">Quantile Estimation Procedures</a>
    </li>
    <li>
      <a href="../articles/units.html">Why Units</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/TxWRI/ldc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate annualized load duration curve</h1>
    <small class="dont-index">Source: <a href="https://github.com/TxWRI/ldc/blob/gh-pages/R/calc_annual_ldc.R" class="external-link"><code>R/calc_annual_ldc.R</code></a></small>
    <div class="hidden name"><code>calc_annual_ldc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculates the median annual ldc with confidence intervals.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">calc_annual_ldc</span><span class="op">(</span>
  <span class="va">.tbl</span>,
  Q <span class="op">=</span> <span class="cn">NULL</span>,
  C <span class="op">=</span> <span class="cn">NULL</span>,
  Date <span class="op">=</span> <span class="cn">NULL</span>,
  allowable_concentration <span class="op">=</span> <span class="cn">NULL</span>,
  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0</span><span class="op">)</span>,
  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High Flows"</span>, <span class="st">"Medium Flows"</span>, <span class="st">"Low Flows"</span><span class="op">)</span>,
  conf_level <span class="op">=</span> <span class="fl">0.9</span>,
  estimator <span class="op">=</span> <span class="fl">6</span>,
  n <span class="op">=</span> <span class="fl">500</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.tbl</dt>
<dd><p>data frame with at least three columns Q (discharge or flow), C
(associated pollutant concentration), and Date.</p></dd>
<dt>Q</dt>
<dd><p>variable name in .tbl for discharge or flow. This must be of class
`units`, typically with a units value of "ft^3/s".</p></dd>
<dt>C</dt>
<dd><p>variable name in .tbl for associated pollutant concentration at a
given flow value. This must be of class `units`, typically with a units
value of "mg/L" or "cfu/100mL".</p></dd>
<dt>Date</dt>
<dd><p>variable name in .tbl for the event Date. This variable must be
of class `Date`.</p></dd>
<dt>allowable_concentration</dt>
<dd><p>an object of class <code>units</code> specifying the
allowable pollutant concentration.</p></dd>
<dt>breaks</dt>
<dd><p>a numeric vector of break points for flow categories. Must be
of length of labels + 1. defaults to <code>c(1, 0.8, 0.4, 0)</code>.</p></dd>
<dt>labels</dt>
<dd><p>labels for the categories specified by breaks.</p></dd>
<dt>conf_level</dt>
<dd><p>numeric, confidence level (default is 0.9) of the median
interval at given exceedance probability.</p></dd>
<dt>estimator</dt>
<dd><p>one of <code>c(5,6,7,8,9,"hd")</code>. <code>6</code> is the default
method correponding to the Weibull plotting position. Further details are
provided in <code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></code>. <code>"hd"</code> uses the Harrell-Davis
Distribution-Free Quantile Estimator (see:
<code><a href="https://rdrr.io/pkg/Hmisc/man/hdquantile.html" class="external-link">hdquantile</a></code>).</p></dd>
<dt>n</dt>
<dd><p>numeric, the length of generated probability points. Larger n may
result in a slightly smoother curve at a cost of increased processing time.
The probability points are used to generate the continuous sample quantiles
types 5 to 9 (see <code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></code>).</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>list of two tibbles (Q and C). Includes variables in .tbl and
  Daily_Flow_Volume (discharge volume), Daily_Load (pollutant sample volume),
  P_Exceedance (exeedance probability), Flow_Category (as defined by breaks
  and labels).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The median annual ldc is calculated by computing the flow duration
  curve for each individual year in the dataset. Exceedance probabilities are
  calculated from the descending order of Daily Flows. By default, the
  Weibull plotting position is used: $$p = P(Q &gt; q_i) =  \frac{i}{n+1}$$
  where \(q_i, i = 1, 2, ... n\), is the i-th sorted streamflow value.</p>
<p>The median streamflow +/- chosen confidence interval is calculated at each
  exceedance probability. The load duration curve is calculated by
  multiplying the median streamflow by the allowable concentration and
  appropriate conversions.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Vogel, Richard M., and Neil M. Fennessey. "Flow-duration curves.
  I: New interpretation and confidence intervals." Journal of Water Resources
  Planning and Management 120, no. 4 (1994): 485-504. doi: <a href="https://doi.org/10.1061/(ASCE)0733-9496(1994)120:4(485)" class="external-link">10.1061/(ASCE)0733-9496(1994)120:4(485)</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Basic example using built in Tres Palacios data</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-quantities/units/" class="external-link">units</a></span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> udunits database from /usr/share/xml/udunits/udunits2.xml</span>
<span class="r-in"><span class="co"># Format data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/units/man/install_unit.html" class="external-link">install_unit</a></span><span class="op">(</span><span class="st">"cfu"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">tres_palacios</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">  <span class="co">## filter data so this run quicker</span></span>
<span class="r-in">  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Indicator_Bacteria</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">  <span class="co">## flow must have units, here is is in cfs</span></span>
<span class="r-in">  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">Flow</span>, <span class="st">"ft^3/s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span>
<span class="r-in">  <span class="co">## pollutant concentration must have units</span></span>
<span class="r-in">  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Indicator_Bacteria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">Indicator_Bacteria</span>, <span class="st">"cfu/100mL"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Calculate LDC</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## specify the allowable concentration</span></span>
<span class="r-in"><span class="va">allowable_concentration</span> <span class="op">&lt;-</span> <span class="fl">126</span></span>
<span class="r-in"><span class="co">## set the units</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/units/man/units.html" class="external-link">units</a></span><span class="op">(</span><span class="va">allowable_concentration</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"cfu/100mL"</span></span>
<span class="r-in"><span class="va">df_ldc</span> <span class="op">&lt;-</span> <span class="fu">calc_annual_ldc</span><span class="op">(</span><span class="va">df</span>,</span>
<span class="r-in">                   Q <span class="op">=</span> <span class="va">Flow</span>,</span>
<span class="r-in">                   C <span class="op">=</span> <span class="va">Indicator_Bacteria</span>,</span>
<span class="r-in">                   Date <span class="op">=</span> <span class="va">Date</span>,</span>
<span class="r-in">                   allowable_concentration <span class="op">=</span> <span class="va">allowable_concentration</span>,</span>
<span class="r-in">                   estimator <span class="op">=</span> <span class="fl">5</span>,</span>
<span class="r-in">                   n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span class="r-in"><span class="va">df_ldc</span><span class="op">$</span><span class="va">Q</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1,000 × 11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    P_Exceedance median_Q lwr.ci_Q upr.ci_Q median_Daily_Flow… lwr.ci_Daily_Flow…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494;">[ft^3/s]</span> <span style="color: #949494;">[ft^3/s]</span> <span style="color: #949494;">[ft^3/s]</span>          <span style="color: #949494;">[100mL/d]</span>          <span style="color: #949494;">[100mL/d]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>     0.000<span style="text-decoration: underline;">500</span>     29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>     0.001<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>     0.002<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>     0.003<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>     0.004<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>     0.005<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>     0.006<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>     0.007<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>     0.008<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>     0.009<span style="text-decoration: underline;">50</span>      29.3     23.8     66.5         716<span style="text-decoration: underline;">846</span>635.         582<span style="text-decoration: underline;">284</span>980.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 990 more rows, and 5 more variables:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   upr.ci_Daily_Flow_Volume [100mL/d], median_Allowable_Daily_Load [cfu/d],</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   lwr.ci_Allowable_Daily_Load [cfu/d], upr.ci_Allowable_Daily_Load [cfu/d],</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   Flow_Category &lt;fct&gt;</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## cleanup</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/units/man/install_unit.html" class="external-link">remove_unit</a></span><span class="op">(</span><span class="st">"cfu"</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael Schramm.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

